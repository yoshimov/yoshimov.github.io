---
layout: post
---
<p><span class="error">categoryプラグインは存在しません。</span></p>
<p><a href="http://www.softether.com/jp/">SoftEther</a>は、仮想LANカードを物理LANに繋げるブリッジ機能をサポートしていますが、この機能はWindows XP以降でしか使えません。</p>
<p>ここで挙げるのは、似たようなことを Windows 2000 Professional のルーティング機能を使って実現した例です。</p>
<h3>環境</h3>
<p>利用環境は、ADSLのルータを使った常時接続環境です。</p>
<p>プライベートネットワークには、数台のマシンがあり、IPは192.168.1.xのプライベートアドレスを振っています。</p>
<p>このプライベートネットワークに、AirH&quot; でインターネットに接続したノートパソコンを参加させるのが目的です。</p>
<h3>準備</h3>
<h4><a href="http://www.softether.com/jp/">SoftEther</a>をインストール</h4>
<p>プライベートネットワーク内にある Windows 2000 Professional のマシン(マシンA)に<a href="http://www.softether.com/jp/">SoftEther</a>の仮想Hubおよび仮想LANカードをインストールします。</p>
<p>また、モバイル用のノートパソコン(マシンB)にも仮想LANカードをインストールします。</p>
<h4>IPアドレスを設定</h4>
<p>マシンAの物理LANカードには固定のIPアドレスを設定します。ここでは、192.168.1.100 とします。</p>
<p>マシンAの仮想LANカードには、仮想のサブネットの固定のIPアドレスを設定します。ここでは、192.168.11.1 とします。この際に、デフォルトゲートウェイは自分自身(192.168.11.1)とします。また、TCP/IPの詳細設定でメトリックを物理LANよりも大きい数値にします。私はゲートウェイメトリックを3、インタフェースメトリックを30としました。（特に根拠なし）</p>
<p>マシンBの仮想LANカードには、仮想のサブネットの固定のIPアドレスを設定します。ここでは、192.168.11.2 とします。デフォルトゲートウェイは、マシンAの仮想IPアドレス(192.168.11.1)を指定します。また、TCP/IPの詳細設定でメトリックを物理LANよりも大きい数値にします。私はゲートウェイメトリックを3、インタフェースメトリックを30としました。</p>
<h4>ルータのポート変換で7777を通すように設定する</h4>
<p>ルータの設定で、外部からの7777ポートへのアクセスを、プライベートネットワークのマシンA 192.168.1.100 に変換するように設定します。</p>
<h4>ルータのスタティックルーティングテーブルを設定</h4>
<p>ルータにスタティックルーティングテーブルが設定できる場合は、192.168.11.0/24 向けのアクセスを 192.168.1.100 にルーティングするように設定しておきます。</p>
<p>これをやっておくと、仮想LANからルータにアクセスできるようになります。</p>
<h4>仮想Hubの設定をする</h4>
<p><a href="http://www.softether.com/jp/">SoftEther</a>の管理ツールを使って、仮想Hub上にアカウントを作成します。ほぼ全ての設定をデフォルトのままにしておいて問題ありません。</p>
<h4>ルーティングサービスを起動する</h4>
<p>マシンAでルーティングサービスを起動します。Windows 2000 Professional ではツールは用意されていませんが、サービス一覧から</p>
<pre>Routing and Remote Access
</pre>
<p>をスタートさせれば、ルーティングが行われるようになります。</p>
<h3>接続</h3>
<h4>マシンA</h4>
<p>マシンAでは、自分の持つ仮想Hubに、仮想LANカードを接続します。</p>
<h4>マシンB</h4>
<p>マシンBで、<a href="http://www.softether.com/jp/">SoftEther</a>の接続マネージャを立ち上げ、マシンAの仮想LANに接続します。</p>
<p>ここで、マシンAの仮想LAN側のIPアドレスにpingが通るか確認しておきます。</p>
<pre>ping 192.168.11.1
</pre>
<h3>ルーティングテーブル更新</h3>
<h4>マシンB</h4>
<p>マシンBは、プライベートネットワークへのリクエストをマシンAに経由させる必要があるため、以下のようにして 192.168.1.x宛ての通信は 192.168.11.1に送るようにルーティング情報を登録します。-p を付けて設定を保存しても問題ありません。</p>
<pre>route add 192.168.1.0 mask 255.255.255.0 192.168.11.1
</pre>
<p>これで、マシンBのプライベートネットワーク側のインタフェースにアクセスできるようになります。また、ルータにスタティックルーティングを設定してあれば、ルータにもアクセスできます。</p>
<h4>プライベートネットワーク内の他のマシン</h4>
<p>プライベートネットワーク内の他のマシンにアクセスしたい場合は、そのマシンのルーティングテーブルも更新する必要があります。</p>
<p>その場合は、以下のように 192.168.11.x宛ての通信をマシンAに送るようにします。</p>
<pre>route add 192.168.11.0 mask 255.255.255.0 192.168.1.100
</pre>
<p>Linuxの場合は以下のようにします。</p>
<pre>route add -net 192.168.11.0 netmask 255.255.255.0 gw 192.168.1.100
</pre>
<p>これで、プライベートネットワーク内のマシンと仮想LANのマシンBが直接通信できるようになります。</p>
<p>ただし、プライベートネットワークとはサブネットが異なるので、仮想LANに直接入っているマシン以外はWindowsのマシン名は利用できません。</p>
<h3>コメント</h3>
<p><span class="error">commentプラグインは存在しません。</span> </p>
